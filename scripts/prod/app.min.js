$(document).ready(function(){var c;var b;firebase.auth().onAuthStateChanged(function(f){if(f){$(".user-logged-out").hide();$(".user-logged-in").fadeIn();c=f.uid;var g=firebase.database().ref("users/"+c);g.on("value",function(h){b=h.val();$("#historyList").empty();$(".user-email").html(b.name);$("#totalAudioTime").html(formatMilliseconds(b.totalAudioTime));$("#totalSessions").html(b.totalSessions);$("#streak").html(b.streak);$("#frequentActivity").html(e(b.stats.activity));$("#startingMood").html(e(b.stats.startingMood));$("#endingMood").html(e(b.stats.endingMood));$.each(b.history,function(k,m){var i=m.date;var l=new Date(i).toDateString();$("#historyList").append("<li><p><em>"+l+"</em></p> "+m.preMood+" <i class='fa fa-plus icon-left icon-right'></i> "+m.activity+" <i class='fa fa-arrow-right icon-left icon-right'></i> "+m.postMood+"</li>")})})}else{$(".user-logged-in").hide();$(".user-logged-out").fadeIn();c="Nobody!";$(".user-email").html("")}});var d;const a=firebase.database().ref("/data");a.on("value",function(h){d=h.val();$("#work-task-list").empty();$("#personal-task-list").empty();$(".mood-list").empty();$.each(d.tasks,function(o,p){if($.inArray("work",p.tags)>-1){$("#work-task-list").append("<li><button class='btn btn-outline task-btn' id='"+p.id+"' name='"+p.title+"' data-origin='work'>"+p.title+"</button></li>")}else{if($.inArray("personal",p.tags)>-1){$("#personal-task-list").append("<li><button class='btn btn-outline task-btn' id='"+p.id+"' name='"+p.title+"' data-origin='personal'>"+p.title+"</button></li>")}}});$.each(d.moods,function(o,p){$(".mood-list").append("<li><button class='btn btn-outline mood-btn' id='"+p.id+"' name='"+p.name+"'>"+p.name+"</button></li>")});var l,f,g,i,k;var m=$("#kfAudio");$(".task-btn").click(function(){l=$(this).attr("id");f=$(this).attr("name");g=$(this).attr("data-origin");changeView("#moods");$("#moodsBack").attr("data-destination",g);$(".upcoming-task").html(f)});$("#moodList .mood-btn").click(function(){i=$(this).attr("id");k=$(this).attr("name");changeView("#audio");$(".current-mood").html(k);$.each(d.audios,function(o,p){if($.inArray(l,p.tags)>-1&&$.inArray(i,p.tags)>-1){$(".audio-name").html(p.title);$("#audioTotalTime").html("<i class='fa fa-sun-o fa-spin'></i>");m.attr("src",p.link);return false}else{$(".audio-name").html("Oops, we haven't uploaded an appropriate audio yet!")}})});$("#cancelAudio").click(function(){changeView("#work");m.get(0).pause()});m.on("canplay",function(o){o.stopImmediatePropagation();$("#audioPlayedTime").html("00:00");$(".audio-progress").css("width","0%");$(".play-pause i").removeClass("fa-pause").addClass("fa-play");$("#audioTotalTime").html(formatSeconds(this.duration))});$(".play-pause").click(function(p){p.preventDefault;var o=m.get(0);if(o.paused==false){o.pause();$(".play-pause i").removeClass("fa-pause").addClass("fa-play")}else{o.play();$(".play-pause i").removeClass("fa-play").addClass("fa-pause")}});$(".seekbar").mouseover(function(){$(this).css("cursor","pointer")});$(".seekbar").click(function(s){var p=m.get(0);var o=s.pageX-$(this).offset().left;var q=$(this).width();var r=p.duration;p.currentTime=o/q*r});m.on("timeupdate",function(){$("#audioPlayedTime").html(formatSeconds(this.currentTime));$(".audio-progress").width(this.currentTime/this.duration*100+"%")});m.on("ended",function(){changeView("#postAudioMood")});$("#postAudioMoodList .mood-btn").click(function(){var r=$(this).attr("name");var y={};var w=m.get(0);var s=Date.now();var p=streakCalc(s);var o=b.totalAudioTime+w.duration*1000;var u=b.totalSessions+1;var x=new Date;var q={date:s,preMood:k,activity:f,activityID:l,postMood:r};var A;$.each(b.stats.startingMood,function(B,C){if(B===k){return A=C+1}});var z;$.each(b.stats.activity,function(B,C){if(B===f){return z=C+1}});var t;$.each(b.stats.endingMood,function(B,C){if(B===r){return t=C+1}});y["/users/"+c+"/streak"]=p;y["/users/"+c+"/streakDate"]=s;y["/users/"+c+"/totalAudioTime"]=o;y["/users/"+c+"/totalSessions"]=u;y["/users/"+c+"/history/"+x]=q;y["/users/"+c+"/stats/startingMood/"+k]=A;y["/users/"+c+"/stats/activity/"+f]=z;y["/users/"+c+"/stats/endingMood/"+r]=t;try{firebase.database().ref().update(y);changeView("#analytics")}catch(v){console.log(v)}})});function e(k){n=undefined;var g=Object.keys(k).length;Object.keys(k).forEach(function(i){if(!n){n=k[i]}else{if(n<k[i]){n=k[i]}}});j=Object.keys(k).filter(function(i){return k[i]==n});if(j.length==g){var f="N/A"}else{if(j.length>1){var f="";for(var h=0;h<j.length;h++){f+=j[h];if(h===j.length-1){break}else{f+=", "}}}else{var f=j}}return f}});