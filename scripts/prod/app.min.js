$(document).ready(function(){var b;const a=firebase.database().ref("/data");a.on("value",function(e){b=e.val();$("#work-task-list").empty();$("#personal-task-list").empty();$(".mood-list").empty();$.each(b.tasks,function(j,k){if($.inArray("work",k.tags)>-1){$("#work-task-list").append("<li><button class='btn btn-outline task-btn' id='"+k.id+"' name='"+k.title+"' data-origin='work'>"+k.title+"</button></li>")}else{if($.inArray("personal",k.tags)>-1){$("#personal-task-list").append("<li><button class='btn btn-outline task-btn' id='"+k.id+"' name='"+k.title+"' data-origin='personal'>"+k.title+"</button></li>")}}});$.each(b.moods,function(j,k){$(".mood-list").append("<li><button class='btn btn-outline mood-btn' id='"+k.id+"' name='"+k.name+"'>"+k.name+"</button></li>")});var h,c,d,f,g;var i=$("#kfAudio");$(".task-btn").click(function(){h=$(this).attr("id");c=$(this).attr("name");d=$(this).attr("data-origin");changeView("#moods");$("#moodsBack").attr("data-destination",d);$(".upcoming-task").html(c)});$("#moodList .mood-btn").click(function(){f=$(this).attr("id");g=$(this).attr("name");changeView("#audio");$(".current-mood").html(g);$.each(b.audios,function(j,k){if($.inArray(h,k.tags)>-1&&$.inArray(f,k.tags)>-1){$(".audio-name").html(k.title);i.attr("src","/audio/"+k.fileName);return false}else{$(".audio-name").html("Oops, we haven't uploaded an appropriate audio yet!")}})});$("#cancelAudio").click(function(){changeView("#work");i.get(0).pause()});i.on("canplay",function(j){j.stopImmediatePropagation();$("#audioPlayedTime").html("00:00");$(".audio-progress").css("width","0%");$(".play-pause i").removeClass("fa-pause").addClass("fa-play");$("#audioTotalTime").html(formatSeconds(this.duration))});$(".play-pause").click(function(k){k.preventDefault;var j=i.get(0);if(j.paused==false){j.pause();$(".play-pause i").removeClass("fa-pause").addClass("fa-play")}else{j.play();$(".play-pause i").removeClass("fa-play").addClass("fa-pause")}});$(".seekbar").mouseover(function(){$(this).css("cursor","pointer")});$(".seekbar").click(function(n){var k=i.get(0);var j=n.pageX-$(this).offset().left;var l=$(this).width();var m=k.duration;k.currentTime=j/l*m});i.on("timeupdate",function(){$("#audioPlayedTime").html(formatSeconds(this.currentTime));$(".audio-progress").width(this.currentTime/this.duration*100+"%")});i.on("ended",function(){changeView("#postAudioMood")});$("#postAudioMoodList .mood-btn").click(function(){var m=$(this).attr("name");var t={};var r=i.get(0);var n=Date.now();var k=streakCalc(n);var j=userProfile.totalAudioTime+r.duration*1000;var p=userProfile.totalSessions+1;var s=new Date;var l={date:n,preMood:g,activity:c,activityID:h,postMood:m};var v;$.each(userProfile.stats.startingMood,function(w,x){if(w===g){return v=x+1}});var u;$.each(userProfile.stats.activity,function(w,x){if(w===c){return u=x+1}});var o;$.each(userProfile.stats.endingMood,function(w,x){if(w===m){return o=x+1}});t["/users/"+currentUser+"/streak"]=k;t["/users/"+currentUser+"/streakDate"]=n;t["/users/"+currentUser+"/totalAudioTime"]=j;t["/users/"+currentUser+"/totalSessions"]=p;t["/users/"+currentUser+"/history/"+s]=l;t["/users/"+currentUser+"/stats/startingMood/"+g]=v;t["/users/"+currentUser+"/stats/activity/"+c]=u;t["/users/"+currentUser+"/stats/endingMood/"+m]=o;try{firebase.database().ref().update(t);changeView("#analytics")}catch(q){console.log(q)}})})});